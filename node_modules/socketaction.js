//供页面调用的方法,实现各个行为的具体逻辑

(function () {

    var globalval    = require('globalval');
    var CONFIG_CONST = require('configconst');
    var nodesocket    = require('nodesocket');
    exports.loginsucc = loginsucc;
    exports.logoutsucc = logoutsucc;
    exports.updateconfsucc = updateconfsucc;

    //允许的请求方法  'IMMED' 表示发送消息后立即返回, 'WAIT'表示等待回复消息
    //         var CONNECT_TYPES = ['IMMED', 'WAIT'];

    /*
    * @method onCheckUpdata 通知adesk-agent EC登录消息
    * @param callbackSuccess {function}  ( data {string} ) xml格式数据
    * @param callbackFaile {function} ( err {object} )    
    */
    function onAgentInfoLogin(sessionId, callbackSuccess, callbackFaile){

        //要发送的地址
        var socketPath = CONFIG_CONST.getval('AGENT_SOCKET');

        //拼接消息
        var inforObj;
        //转换为json
        var inforJson = JSON.stringify(inforObj);

        //发送消息
        nodesocket.onShortSocket(socketPath, inforJson, callbackSuccess, callbackFaile);
    }

    //{"signal": "info_config", "params": {"module": "*"}}
    //{"signal": "info_logout", "params": {"session_id": "*"}}
    //{"signal": "info_login", "params": {"session_id": "*"}}
    //
    function loginsucc(sessionId){
        var socketPath = CONFIG_CONST.getval('AGENT_SOCKET');
        var infoObj = {
            "signal":"info_login",
            "params":{
                "session_id": sessionId
            }
        };
        var infoJson = JSON.stringify(infoObj);
        infoJson += "\n";

        nodesocket.onShortSocket(socketPath,infoJson,'IMMED',null,null);
    }

    function logoutsucc(sessionId){
        var socketPath = CONFIG_CONST.getval('AGENT_SOCKET');
        var infoObj = {
            "signal":"info_logout",
            "params":{
                "session_id": sessionId
            }
        };
        var infoJson = JSON.stringify(infoObj);

        infoJson += "\n";

        nodesocket.onShortSocket(socketPath,infoJson,'IMMED',null,null);        
    }

    function updateconfsucc(module){
        var socketPath = CONFIG_CONST.getval('AGENT_SOCKET');
        var infoObj = {
            "signal":"info_config",
            "params":{
                "module": module
            }
        };
        var infoJson = JSON.stringify(infoObj);

        infoJson += "\n";

        nodesocket.onShortSocket(socketPath,infoJson,'IMMED',null,null);   
    }
    
})()    