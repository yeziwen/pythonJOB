/*
 * Author: jp
 * Function: 日志系统，利用第三方modules, node-syslog,向syslog输出日志
 */

(function () {

    exports.fatal = fatal;
    exports.error = error;
    exports.warn = warn;
    exports.log = log;
    exports.debug = debug;

    var CONFIG_CONST = require('configconst');

    var logname         = CONFIG_CONST.getval('LOG_NAME');
    var loglevel        = CONFIG_CONST.getval('LOG_LEVELS');
    var logMAPPINGS     = CONFIG_CONST.getval('LOG_MAPPINGS');
    var sysLogLevel     = CONFIG_CONST.getval('DEFAULT_SYS_LOG_LEVEL');
    var consoleLogLevel = CONFIG_CONST.getval('DEFAULT_CONSOLE_LOG_LEVEL');

    //init syslog
    var syslog = require('node-syslog')
    syslog.init(logname, syslog.LOG_PID | syslog.LOG_0DELAY, syslog.LOCAL0)

    function fatal(data){
        checkIsLog('FATAL', data);
    }

    function error(data){
        checkIsLog('ERROR', data);   
    }

    function warn(data){
        checkIsLog('WARN', data);
    }

    function log (data) {
        checkIsLog('LOG', data);
    }

    function debug (data) {
        checkIsLog('DEBUG', data);    
    }   

    function checkIsLog (level, data) {
        
        if(loglevel[level] >= loglevel[consoleLogLevel]){
            console.log(data);
        }

        if(loglevel[level] >= loglevel[sysLogLevel]){
            syslog.log(logMAPPINGS.level, data);
        }
    }

})()